/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License
 * 2.0; you may not use this file except in compliance with the Elastic License
 * 2.0.
 */

import React from 'react';
import {
  Chart,
  Settings,
  Axis,
  BarSeries,
  timeFormatter,
  niceTimeFormatByDay,
} from '@elastic/charts';
import { useCnvmStatisticsApi } from '../../common/api/use_vulnerabilities_stats_api';
import { getSeverityStatusColor } from '../../common/utils/get_vulnerability_colors';
import { ChartPanel } from '../../components/chart_panel';
import { VULNERABILITIES_SEVERITY } from '../../../common/constants';

const data = [
  { critical: 4400, high: 3000, medium: 2000, low: 1000, time: 1 },
  { critical: 1000, high: 2000, medium: 2000, low: 1000, time: 2 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 3 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 4 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 5 },
  { critical: 4000, high: 2000, medium: 2000, low: 1000, time: 6 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 7 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 8 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 9 },
  { critical: 4000, high: 1000, medium: 2000, low: 1000, time: 10 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 11 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 12 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 13 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 14 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 15 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 16 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 17 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 18 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 19 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 20 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 21 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 22 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 23 },
  { critical: 4000, high: 3000, medium: 2000, low: 1000, time: 24 },
];

const stackAccessors = [
  VULNERABILITIES_SEVERITY.CRITICAL,
  VULNERABILITIES_SEVERITY.HIGH,
  VULNERABILITIES_SEVERITY.MEDIUM,
  VULNERABILITIES_SEVERITY.LOW,
];

export const VulnerabilityTrendGraph = () => {
  const getCnvmStats = useCnvmStatisticsApi();
  const trendData = getCnvmStats.data?.vulnTrends || [];

  return (
    <ChartPanel title={'Trend by Severity'}>
      <div style={{ width: '100%', height: 300 }}>
        <Chart>
          <Settings
            legendPosition="right"
            showLegend
            theme={{
              scales: {
                barsPadding: 0.05,
              },
            }}
          />
          <Axis
            id="bottom"
            position={'bottom'}
            tickFormat={timeFormatter(niceTimeFormatByDay(2))}
            ticks={3}
          />
          <Axis
            id="left"
            position={'left'}
            tickFormat={(number: any) =>
              number.toLocaleString(undefined, {
                notation: 'compact',
                maximumFractionDigits: 1,
              })
            }
          />
          <BarSeries
            id={VULNERABILITIES_SEVERITY.CRITICAL}
            xAccessor={'@timestamp'}
            yAccessors={['critical']}
            stackAccessors={stackAccessors}
            data={trendData}
            color={getSeverityStatusColor(VULNERABILITIES_SEVERITY.CRITICAL)}
            minBarHeight={5}
          />
          <BarSeries
            id={VULNERABILITIES_SEVERITY.HIGH}
            xAccessor={'@timestamp'}
            yAccessors={['high']}
            stackAccessors={stackAccessors}
            data={trendData}
            color={getSeverityStatusColor(VULNERABILITIES_SEVERITY.HIGH)}
            minBarHeight={5}
          />
          <BarSeries
            id={VULNERABILITIES_SEVERITY.MEDIUM}
            xAccessor={'@timestamp'}
            yAccessors={['medium']}
            stackAccessors={stackAccessors}
            data={trendData}
            color={getSeverityStatusColor(VULNERABILITIES_SEVERITY.MEDIUM)}
            minBarHeight={5}
          />
          <BarSeries
            id={VULNERABILITIES_SEVERITY.LOW}
            xAccessor={'@timestamp'}
            yAccessors={['low']}
            stackAccessors={stackAccessors}
            data={trendData}
            color={getSeverityStatusColor(VULNERABILITIES_SEVERITY.LOW)}
            minBarHeight={5}
          />
        </Chart>
      </div>
    </ChartPanel>
  );
};
